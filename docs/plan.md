# 诗词接龙游戏 - 实现执行计划

## 阶段1：MVP基础功能（8个步骤）

### 步骤1：项目基础架构搭建
**任务**：创建项目结构和基础文件
**创建/修改文件**：
- `index.html`：单页面HTML结构
- `style.css`：基础样式（网格背景、面板布局）
- `script.js`：空的主脚本文件
- `package.json`（如需）：项目依赖配置

**快速验证**：
- 打开 index.html，确认页面可访问
- 检查浏览器控制台无错误

---

### 步骤2：无限方格画布渲染
**任务**：实现60px单元格的无限方格背景
**创建/修改文件**：
- `style.css`：添加网格样式（60px单元格，浅灰色网格线）
- `script.js`：添加画布渲染逻辑、坐标系统、transform变换

**快速验证**：
- 打开页面，确认显示浅灰色网格背景
- 鼠标拖拽可移动视角
- 滚轮缩放可见网格缩放效果

---

### 步骤3：首句初始化与渲染
**任务**：自动生成首句"春江潮水连海平"并渲染到中心
**创建/修改文件**：
- `script.js`：
  - 初始化poems数组
  - 初始化cells Map
  - 渲染首句（白色背景，灰色边框）
  - 设置初始视角聚焦中心

**快速验证**：
- 打开页面，自动显示首句"春江潮水连海平"（横向）
- 诗句位于画面中心
- 白色背景，灰色边框
- 回合数显示"1"，诗句数显示"1"

---

### 步骤4：方向选择器交互
**任务**：悬停汉字显示方向选择器，点击进入草稿模式
**创建/修改文件**：
- `style.css`：方向选择器样式（上下左右箭头）
- `script.js`：
  - 汉字悬停事件监听
  - 方向选择器显示/隐藏逻辑
  - 点击方向箭头进入草稿模式
  - 草稿状态管理

**快速验证**：
- 鼠标悬停在首句任意汉字上，显示四个方向箭头围绕该字
- 点击箭头后隐藏选择器
- 状态标签更新为"编辑诗句"

---

### 步骤5：草稿输入与实时预览
**任务**：草稿模式下的输入框和黄色背景预览
**创建/修改文件**：
- `index.html`：添加底部草稿操作栏结构
- `style.css`：草稿操作栏样式、草稿预览黄色背景
- `script.js`：
  - 草稿数据结构
  - 输入框实时监听
  - 草稿位置计算（根据anchor和direction）
  - 草稿预览渲染

**快速验证**：
- 点击方向箭头后底部显示草稿操作栏
- 输入框自动获取焦点
- 输入汉字后在方格中实时显示黄色背景预览
- 预览位置根据连接点和方向正确计算

---

### 步骤6：基本验证与提交
**任务**：重合点字符一致检查，确认提交诗句
**创建/修改文件**：
- `script.js`：
  - 碰撞检测逻辑（遍历cells Map）
  - 重合点字符对比验证
  - 确认按钮启用/禁用逻辑
  - 提交逻辑（添加到poems数组、更新cells Map）
  - 回合数和诗句数更新

**快速验证**：
- 输入与首句有重合字的诗句，重合点位置正确
- 点击确认按钮后诗句固定到版图（白色背景）
- 回合数+1，诗句数+1
- 退出草稿模式，隐藏草稿操作栏

---

### 步骤7：控制面板完善
**任务**：完善左上角控制面板所有组件
**创建/修改文件**：
- `index.html`：添加控制面板所有组件（标题、状态标签、回合数、诗句数、重置视图、清空所有）
- `style.css`：控制面板布局和样式
- `script.js`：各按钮点击事件处理、状态更新逻辑

**快速验证**：
- 显示标题"诗词接龙"
- 状态标签显示"选择连接点"或"编辑诗句"
- 回合数和诗句数正确显示
- 重置视图按钮可点击
- 清空所有按钮显示

---

### 步骤8：MVP集成测试
**任务**：完整流程测试，确保MVP功能完整可用
**创建/修改文件**：
- 无新增文件，主要是调试和修复

**快速验证**：
- 执行完整游戏流程：选择连接点 → 输入诗句 → 提交 → 再选择 → 再提交
- 每个步骤按预期工作
- 无控制台错误

---

## 阶段2：完整功能版本（8个步骤）

### 步骤9：视觉反馈高亮
**任务**：有效重合字绿色、冲突字红色、连接锚点蓝色
**创建/修改文件**：
- `style.css`：绿色、红色、蓝色高亮样式
- `script.js`：
  - 重合点标记逻辑
  - 冲突检测标记逻辑
  - 连接锚点蓝色边框渲染

**快速验证**：
- 有效重合字显示绿色高亮
- 冲突字显示红色高亮
- 连接锚点显示蓝色边框

---

### 步骤10：旋转按钮功能
**任务**：点击旋转按钮切换横纵向
**创建/修改文件**：
- `index.html`：添加旋转按钮"↻ 旋转"
- `style.css`：旋转按钮样式
- `script.js`：
  - 旋转按钮点击事件
  - 草稿方向切换逻辑（H↔V）
  - 切换后重新计算草稿位置

**快速验证**：
- 点击旋转按钮后草稿方向切换
- 草稿预览位置重新计算并渲染

---

### 步骤11：拖拽平移与缩放限制
**任务**：完善拖拽平移、滚轮缩放（0.3x-3x范围）
**创建/修改文件**：
- `script.js`：
  - 拖拽平移事件处理
  - 滚轮缩放事件处理
  - 缩放范围限制（0.3x-3x）
  - 以鼠标位置为中心缩放

**快速验证**：
- 鼠标拖拽可移动视角
- 滚轮缩放视角，范围0.3x-3x
- 缩放以鼠标位置为中心

---

### 步骤12：重置视图功能
**任务**：点击重置视图按钮回到最后放置诗句中心
**创建/修改文件**：
- `script.js`：
  - 记录最后放置诗句位置
  - 重置视图按钮点击事件
  - 视角复位逻辑

**快速验证**：
- 放置诗句后移动视角
- 点击重置视图按钮
- 视角回到最后放置诗句中心

---

### 步骤13：历史记录面板
**任务**：右上角历史记录面板，列表显示、自动滚动
**创建/修改文件**：
- `index.html`：添加历史记录面板结构
- `style.css`：历史记录面板样式
- `script.js`：
  - 历史记录数据结构
  - 提交诗句后添加历史记录
  - 最新记录在顶部
  - 自动滚动到顶部

**快速验证**：
- 提交诗句后历史记录列表新增一条记录
- 记录格式"回合X [方向图标] 诗句内容"
- 最新记录在顶部
- 新增记录后自动滚动

---

### 步骤14：清空所有功能
**任务**：清空所有按钮，二次确认对话框
**创建/修改文件**：
- `index.html`：添加确认对话框结构
- `style.css`：确认对话框样式
- `script.js`：
  - 清空所有按钮点击事件
  - 二次确认逻辑
  - 重置到初始状态

**快速验证**：
- 点击清空所有按钮弹出确认对话框
- 点击确认后游戏重置（首句"春江潮水连海平"，回合1，诗句1）
- 点击取消后关闭对话框

---

### 步骤15：取消草稿功能
**任务**：取消按钮退出草稿模式
**创建/修改文件**：
- `index.html`：添加取消按钮
- `style.css`：取消按钮样式
- `script.js`：
  - 取消按钮点击事件
  - 清空草稿数据
  - 清空预览渲染
  - 退出草稿模式

**快速验证**：
- 草稿模式下点击取消按钮
- 草稿数据清空，预览消失
- 退出草稿模式，状态标签更新为"选择连接点"

---

### 步骤16：完整功能版本测试
**任务**：所有功能集成测试
**创建/修改文件**：
- 无新增文件，主要是调试和修复

**快速验证**：
- 执行完整游戏流程，测试所有功能
- 视觉反馈正确（绿色、红色、蓝色高亮）
- 旋转、拖拽、缩放、重置视图正常
- 历史记录正确更新
- 清空所有和取消草稿正常

---

## 阶段3：优化版本（8个步骤）

### 步骤17：输入限制与过滤
**任务**：输入框maxlength=20，trim处理和输入过滤
**创建/修改文件**：
- `index.html`：输入框添加maxlength="20"
- `script.js`：
  - 输入trim处理
  - 输入过滤（允许中文、标点、空格）

**快速验证**：
- 输入超过20字时禁止继续输入
- 输入前后空格自动trim
- 允许输入中文、标点、空格

---

### 步骤18：草稿模式禁用拖拽
**任务**：草稿模式下禁用拖拽平移
**创建/修改文件**：
- `script.js`：
  - 草稿状态检测
  - 拖拽事件中添加草稿模式判断

**快速验证**：
- 非草稿模式下可拖拽平移
- 草稿模式下拖拽无效

---

### 步骤19：视角自动聚焦连接点
**任务**：进入草稿模式后视角自动聚焦到连接点
**创建/修改文件**：
- `script.js`：
  - 进入草稿模式时计算连接点屏幕坐标
  - 自动移动视角到连接点位置

**快速验证**：
- 点击方向箭头进入草稿模式
- 视角自动聚焦到连接点位置

---

### 步骤20：失焦处理
**任务**：输入框失焦时保持草稿状态，不自动提交
**创建/修改文件**：
- `script.js`：
  - 输入框失焦事件监听
  - 保持草稿状态逻辑

**快速验证**：
- 输入诗句后点击输入框外部
- 草稿预览保持显示
- 不自动提交

---

### 步骤21：无重合点检测
**任务**：输入诗句与现有诗句无重合时禁用确认按钮
**创建/修改文件**：
- `script.js`：
  - 无重合点检测逻辑
  - 确认按钮启用条件添加重合点判断

**快速验证**：
- 输入与现有诗句无重合的诗句
- 确认按钮保持禁用状态

---

### 步骤22：全是已有字检测
**任务**：输入诗句所有字都已被占用时禁用确认按钮
**创建/修改文件**：
- `script.js`：
  - 全是已有字检测逻辑
  - 确认按钮启用条件添加新字判断

**快速验证**：
- 输入诗句所有字都已被占用
- 确认按钮保持禁用状态

---

### 步骤23：多重合点支持
**任务**：支持与多条诗句产生多个重合点
**创建/修改文件**：
- `script.js`：
  - 多重合点检测逻辑
  - 所有有效重合字绿色高亮
  - 所有冲突字红色高亮

**快速验证**：
- 输入诗句与多条现有诗句产生多个重合点
- 所有有效重合字显示绿色高亮
- 所有重合点字符一致时确认按钮启用

---

### 步骤24：最终测试与优化
**任务**：完整功能测试，修复bug，性能优化
**创建/修改文件**：
- 无新增文件，主要是调试、修复和优化

**快速验证**：
- 执行完整游戏流程，测试所有功能
- 无控制台错误
- 性能流畅，无明显卡顿
- 所有验收标准通过

---

## 总计：24个可执行步骤

| 阶段 | 步骤数 | 完成标志 |
|------|--------|----------|
| MVP基础功能 | 8 | 可完成基本游戏流程 |
| 完整功能版本 | 8 | 所有功能可用 |
| 优化版本 | 8 | 所有验收标准通过 |

**每个步骤完成后立即进行快速验证，确保功能正确后再进入下一步。**

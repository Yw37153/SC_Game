# 产品需求文档 (PRD)
# 本体Prompt
## 诗词接龙游戏 - 完整开发Prompt

### 一、游戏概述
开发一个基于无限方格的诗词接龙填字游戏。玩家通过共享汉字连接诗句，形成纵横交错的诗词版图。

### 二、核心机制

**连接规则**
- 新诗句必须与已有诗句至少共享1个汉字（重合位置字符必须完全一致）
- 仅支持横向（左→右）和纵向（上→下）两个方向，禁止斜向
- 允许与多个已有诗句产生多个重合点
- 禁止完全覆盖已有诗句（必须包含新字）

**回合流程**
1. **选择连接点**：点击已有诗句的任意汉字，显示方向选择器（上下左右箭头）
2. **进入草稿**：选择方向后进入草稿模式，视角自动聚焦到该位置
3. **输入诗句**：在输入框中输入诗句，实时预览在方格中的位置
4. **调整位置**：支持拖动调整连接字在诗句中的位置（改变offset）
5. **确认提交**：验证无冲突后提交，诗句固定到版图

### 三、验证规则（宽松模式）
- 重合位置字符不一致 → 标记冲突（红色），禁止提交
- 无重合点 → 禁止提交
- 全是已有字（无新字）→ 禁止提交
- 满足条件后确认按钮启用

### 四、交互细节

**地图操作**
- 拖拽平移：鼠标拖拽移动无限方格（草稿模式下禁用）
- 滚轮缩放：0.3x - 3x范围缩放
- 重置视图：按钮回到最后放置位置或初始中心

**草稿模式**
- 输入实时渲染预览（黄色背景）
- 有效重合字：绿色高亮
- 冲突字：红色高亮
- 连接锚点：蓝色边框高亮
- 旋转按钮：切换横纵向
- 取消按钮：退出草稿不保存

**视觉反馈**
- 已确认诗句：白色背景，灰色边框
- 连接点悬停：显示方向箭头（上下左右）
- 拖动提示：显示"拖动调整位置"提示

### 五、UI布局（简约白色风格）

**左上角控制面板**
- 标题：诗词接龙
- 当前状态标签：选择连接点/编辑诗句
- 回合数、诗句数统计
- 重置视图按钮、清空所有按钮

**右上角历史记录面板**
- 标题：历史记录
- 列表项：回合数 + 方向 + 诗句内容
- 最新在上，自动滚动

**底部中央草稿操作栏（草稿模式显示）**
- 输入框：placeholder"输入诗句..."，maxlength20
- 旋转按钮：↻ 旋转
- 取消按钮：退出草稿
- 确认按钮：primary样式，验证通过后启用

**主视图**
- 无限方格背景：浅灰色网格线（60px单元格）
- 字体：Noto Serif SC衬线体
- 配色：白、灰、蓝、绿、黄、红（仅用于状态反馈）

### 六、初始状态
- 自动生成首句："春江潮水连海平"（横向，中心位置）
- 回合数：1
- 视角聚焦在首句中心

### 七、技术实现

**数据结构**
```javascript
poems: [{text, x, y, direction, turn}]
cells: Map<"x,y", {char, poemIndex, element}>
draft: {anchorX, anchorY, anchorChar, direction, text, offset, cells[]}
```

**坐标系统**
- 单元格尺寸：60px × 60px
- 地图尺寸：200000px × 200000px（虚拟无限）
- 初始定位：(-100000 + viewport/2)

**关键计算**
- 草稿起始位置：根据anchor和offset计算
- 碰撞检测：遍历每个字检查cells Map
- 拖动调整：鼠标delta/60px计算offset变化

### 八、边界处理
- 清空所有：二次确认后重置，保留初始诗句
- 输入过滤：trim处理，允许中文、标点、空格
- 空输入：清空预览，禁用确认
- 失焦处理：保持草稿状态，不自动提交


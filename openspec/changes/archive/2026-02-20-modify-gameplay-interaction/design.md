## Context

当前诗词接龙游戏采用"悬停-箭头选择"的交互模式：
- 玩家悬停在已有汉字上时显示方向箭头
- 点击箭头进入草稿模式，选择诗句延伸方向
- 这种设计对触屏设备不够友好，且新玩家难以理解

新设计将改为"点击-高亮-输入-验证"流程，更符合直觉。

## Goals / Non-Goals

**Goals:**
- 点击已有汉字时高亮显示相邻可填空位置（上下左右）
- 点击高亮空格进入输入模式
- 输入完成后统一进行规则验证
- 同时支持鼠标和触摸操作
- 保持向后兼容（现有游戏数据可正常加载）

**Non-Goals:**
- 不改变游戏核心规则（接龙规则、胜负判定）
- 不修改画布渲染系统（缩放、平移）
- 不引入外部依赖
- 不改变现有的诗句存储格式

## Decisions

### 1. 使用两层点击检测机制
**Decision**: 点击检测分为两个阶段：
- 第一阶段：检测是否点击已有汉字 → 进入"选择源"状态，高亮相邻空格
- 第二阶段：检测是否点击高亮空格 → 进入草稿模式

**Rationale**: 将原本的单次方向选择拆分为两次点击，降低误触率，同时给玩家明确的视觉反馈。

**Alternatives**: 
- 长按显示菜单（增加操作复杂度）
- 拖拽选择（与画布拖拽冲突）

### 2. 高亮样式使用半透明绿色覆盖
**Decision**: 可填空位置使用半透明绿色（rgba(100, 255, 100, 0.3)）覆盖单元格背景，边框使用深绿色。

**Rationale**: 绿色表示"可点击/可交互"是常见 UI 惯例，半透明不影响查看底层网格。

### 3. 保留验证逻辑但延迟执行时机
**Decision**: 原有的 `validateDraft()` 逻辑保持不变，但调用时机从输入过程中改为输入完成后（点击提交按钮时）。

**Rationale**: 复用现有验证逻辑减少代码重复，延迟验证让玩家可以先输入完整想法再调整。

### 4. 状态机设计
**Decision**: 游戏状态新增 `selectionMode` 布尔值，表示是否处于"选择源字"状态。原有的 `draftMode` 保持不变。

状态流转：
```
空闲 → [点击汉字] → 选择模式 (高亮空格)
选择模式 → [点击空格] → 草稿模式 (输入中)
选择模式 → [点击空白/按ESC] → 空闲
草稿模式 → [提交/取消] → 空闲
```

**Rationale**: 新增独立状态避免与现有草稿模式逻辑混淆，便于分别处理绘制和事件。

### 5. 触摸设备适配
**Decision**: 触摸设备上点击汉字后高亮空格，虚拟按钮的"方向键"在"选择模式"下暂时隐藏，"A1"按钮改为"取消选择"。

**Rationale**: 触屏上方向键在选择模式下无意义，减少界面元素避免误触。

## Risks / Trade-offs

| Risk | Mitigation |
|------|-----------|
| 老玩家不习惯新交互 | 在 README 中说明变更，提供 GIF 演示新流程 |
| 高亮绘制性能问题 | 最多同时高亮 4 个格子，性能影响可忽略 |
| 与画布拖拽冲突 | 选择模式下禁用拖拽，点击空白处退出选择模式并恢复拖拽 |
| 验证失败时用户体验差 | 验证失败时在草稿栏显示红色提示，允许用户直接修改 |

## Migration Plan

此变更不涉及数据迁移，现有 `gameState` 结构和保存的游戏数据格式保持不变。

部署步骤：
1. 替换 `script.js` 中的交互处理函数
2. 更新 `style.css` 添加高亮样式
3. 测试现有保存的游戏是否正常加载和继续

Rollback: 直接回退到上一个版本的 `script.js` 即可。

## Open Questions

- 是否需要在高亮空格旁显示诗句方向的提示图标？（待用户测试后决定）
- 选择模式下是否支持键盘方向键快速选择空格？
